<body>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<style>
    div#favouritesBarContentPane ul#favouritesBarBar {
        list-style-type: none;
        padding: 0px;
    }

    div#favouritesBarContentPane ul#favouritesBarBar li.item {
        display:inline-block;
        margin: 0px;
        padding: 0px;
    }

    div#favouritesBarContentPane ul#favouritesBarBar li.item div.item {
        display:inline-block;
        background-color: lightgrey;
        margin-left: 5px;
        margin-right: 5px;
        padding: 8px;
        border-radius: 3px;
        border: 1px solid dimgrey;
        line-height: 20px;
        text-align:center;
        height: 20px;
    }

    div#favouritesBarContentPane ul#favouritesBarBar li.item div.item:hover {
        background-color: gray;
    }

    div#favouritesBarContentPane ul#favouritesBarBar li.item div.item:active {
        background-color: dimgray;
    }

    div#favouritesBarContentPane div#favouritesBarInputForm div span.inputLabel {
        display: inline-block;
        width: 60px;
        text-align: center;
        float: left;
        height: 20px;
        line-height: 20px;
        margin-top: 5px;
        margin-bottom: 5px;
    }

    div#favouritesBarContentPane div#favouritesBarInputForm div input.input102 {
        display: inline-block;
        width: 200px;
        margin-top: 5px;
        margin-bottom: 5px;
        float:right;
    }

    div#favouritesBarContentPane div#favouritesBarInputForm div.button {
        display: inline-block;
        width: 125px;
        padding: 4px;
        margin-top: 6px;
        margin-bottom: 5px;
        height: 20px;
        border: 1px solid dimgrey;
        text-align: center;
        border-radius: 3px;
        float: right;
    }

    div#favouritesBarContentPane div#favouritesBarInputForm div#smallerButton.button {
        width: 60px;
        float: left;
    }

    div#favouritesBarContentPane div#favouritesBarInputForm div.button:hover {
        background-color: gray;
    }

    div#favouritesBarContentPane div#favouritesBarInputForm div.button:active{
        background-color: dimgrey;
    }

    div#favouritesBarContentPane div#favouritesBarInputForm {
        display: none;
        background-color: lightgrey;
        padding: 10px;
        border-radius: 4px;
        width: 276px;
        height: 100px;
    }
</style>

<script>
    var favourtiesBarPreLoadedCachedData;
    const FAVOURITES_BAR_CACHE_NAME = 'favourites-myPortal-cache';

    // USE localStorage['varname'] to save favourites and load all values into array for faster access
    function openAddMenu() {
        document.getElementById("favouritesBarInputForm").style.display = "block";
        document.getElementById("favouritesBarBar").style.display = "none";
    }

    function closeAddFavouritesMenu() {
        document.getElementById("favouritesBarInputForm").style.display = "none";
        document.getElementById("favouritesBarBar").style.display = "block";
    }

    function clickedFavourite(item) {
        window.open(item.getAttribute("href"),'_blank');
    }

    function removeFromBookmarks(item) {
        removeFromStorage(item.getAttribute("index"));
        item.remove();
    }

    function saveToFile(name, link) {
        if (localStorage && localStorage.getItem(FAVOURITES_BAR_CACHE_NAME)) {
            var storage = JSON.parse(localStorage.getItem(FAVOURITES_BAR_CACHE_NAME));
            storage.favourites.push({"name":name, "link":link});
            favourtiesBarPreLoadedCachedData = storage;
            localStorage.setItem(FAVOURITES_BAR_CACHE_NAME, JSON.stringify(storage));
        }
        else {
            var data = {"favourites":[{"name":name, "link":link}]};
            favourtiesBarPreLoadedCachedData = data;
            localStorage.setItem(FAVOURITES_BAR_CACHE_NAME, JSON.stringify(data));
        }
        console.log(JSON.parse(localStorage.getItem(FAVOURITES_BAR_CACHE_NAME)));
    }

    function loadFavouritesBarData() {
        if (localStorage && localStorage.getItem(FAVOURITES_BAR_CACHE_NAME)) {
            var storage = JSON.parse(localStorage.getItem(FAVOURITES_BAR_CACHE_NAME));
            for(var i = 0; i < storage.favourites.length; i++) {
                internalAddToFavourites(storage.favourites[i].name, storage.favourites[i].link, i);
            }
            favourtiesBarPreLoadedCachedData = storage;
        } else {
            favourtiesBarPreLoadedCachedData = {"favourites":[]};
        }
    }

    function addToFavourites() {
        var text = document.getElementById("addToListName").value.trim();
        var link = document.getElementById("addToListLink").value.trim();

        if(link === null || link === "") {
            alert("You entered an invalid link! Please re-enter.")
        } else {
            if(text == null || text == "") {
                text = link;
            }
            var index = favourtiesBarPreLoadedCachedData.favourites.length;
            internalAddToFavourites(text, link, index);
            saveToFile(text, link);
            closeAddFavouritesMenu();
        }
    }

    function internalAddToFavourites(name, link, index) {
        var list = document.getElementById("favouritesBarBar");
        var li = document.createElement("LI");
        var div = document.createElement("DIV");
        var textNode = document.createTextNode(name);
        div.appendChild(textNode);
        div.setAttribute("class", "item");
        li.setAttribute("href", link);
        li.setAttribute("onclick", "clickedFavourite(this)");
        li.setAttribute("oncontextmenu", "removeFromBookmarks(this)");
        li.appendChild(div);
        li.setAttribute("class", "item");
        li.setAttribute("index", index);
        list.appendChild(li);
    }

    function removeFromStorage(index) {
        favourtiesBarPreLoadedCachedData.favourites.splice(index, 1);
        localStorage.setItem(FAVOURITES_BAR_CACHE_NAME, JSON.stringify(favourtiesBarPreLoadedCachedData));
    }

    window.onload = loadFavouritesBarData;

</script>

<div id="favouritesBarContentPane">
    <ul id="favouritesBarBar"><li class="item"><div class="item" onclick="openAddMenu()">New bookmark</div></li></ul>
    <div id="favouritesBarInputForm">
        <div><span class="inputLabel">Link</span> <input id = "addToListLink" class="input102" placeholder="http://york.ca"></div>
        <div><span class="inputLabel">Name</span> <input id = "addToListName" class="input102" placeholder="York Region"></div>
        <div class="button" id="smallerButton" onclick="closeAddFavouritesMenu()">Cancel</div>
        <div class="button" onclick="addToFavourites()">Add to favourties</div>
    </div>
</div>
</body>