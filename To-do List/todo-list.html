<body>
	<style>
		.box-design {
			border: 5px outset gray;
			padding: 5px;
			height: 95%;
			width: 95%;
			margin: 0px;
		}
		#__SPNS__ulList {
			list-style-type: none;
		}

        .__SPNS__li {
            display: block;
            background-color: lightgray;
            width: 100px;
            margin = 5px;
        }
	</style>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>

	<div class = "box-design">
		<input id = "__SPNS__input" type= "text" placeholder="Remember to do something">
		<button onclick="__SPNS__addToList()">Add to list</button>
		<ul id="__SPNS__ulList"></ul>
	</div>
	<script>
        var __SPNS__myspHelper = [Plugin:Portlet key="namespace" compute="once"]spHelper;

        function __SPNS__addElement(text, num) {
            if (text.trim() != "") {
                var textNode = document.createTextNode(text);
                var li = document.createElement("LI");
                li.setAttribute("class", "__SPNS__li");
                li.appendChild(textNode);
                document.getElementById("__SPNS__ulList").appendChild(li);
                li.setAttribute("index", (num+""));
            }
        }

        function __SPNS__setToDoListPortletPreferences(obj) {
            if(obj === null)
                __SPNS__myspHelper.setPortletPreferences(null);
            __SPNS__myspHelper.setPortletPreferences(JSON.stringify(obj));
            __SPNS__myspHelper.getPortletPreferences().then(function(prefData){
                console.log(JSON.parse(prefData));
            }, function(error){console.log("error");});
        }

        function __SPNS__addToList() {
            var text = document.getElementById("__SPNS__input").value;
            document.getElementById("__SPNS__input").value = null;
            if (text.trim() != "") {
                var textNode = document.createTextNode(text);
                var li = document.createElement("LI");
                li.appendChild(textNode);
                li.setAttribute("class", "__SPNS__li");
                document.getElementById("__SPNS__ulList").appendChild(li);
                var data = {"myData":[text]};
                __SPNS__myspHelper.getPortletPreferences().then(function(prefData){
                    if(prefData !== null) {
                        var obj = JSON.parse(prefData);
                        if (obj.myData !== null) {
                            li.setAttribute("index", ((obj.myData.length) + ""));
                            obj.myData.splice(obj.myData.length, 0, text);
                            __SPNS__setToDoListPortletPreferences(obj);
                        }
                        else {
                            __SPNS__setToDoListPortletPreferences(data);
                        }
                    }
                    else {
                        __SPNS__setToDoListPortletPreferences(data);
                    }
                }, function(error){return;});
            }
        }

        function __SPNS__removeFromList(index) {
            __SPNS__myspHelper.getPortletPreferences().then(function(prefData){
                var obj = JSON.parse(prefData);
                obj.myData.splice(index, 1);
                __SPNS__setToDoListPortletPreferences(obj);
            }, function(error){return;});
        }

        function __SPNS__loadToDoListPortletPreferenceData() {
            __SPNS__myspHelper.getPortletPreferences().then(function(prefData) {
                var temp = {"myData":[]};
                if(prefData !== null) {
                    obj = JSON.parse(prefData);
                    console.log(obj);
                    if (obj.myData !== null) {
                        for (var i = 0; i < obj.myData.length; i++) {
                            __SPNS__addElement(obj.myData[i], i);
                        }
                    }
                    else {
                        __SPNS__setToDoListPortletPreferences(temp);
                    }
                }
                else {
                    __SPNS__setToDoListPortletPreferences(temp);
                }
            }, function(error) {
                return;
            });
        };

        $("#__SPNS__ulList").on('click', 'li', function() {
            var temp = $(this).attr("index");
            __SPNS__removeFromList(temp);
            $(this).remove();
        });

        $("#__SPNS__input").keydown(function(event){
            if(event.which === 13) {
                __SPNS__addToList();
            }
        })

        $(document).ready(function() {
            console.log(__SPNS__myspHelper.userCn);
            __SPNS__loadToDoListPortletPreferenceData();
        });
	</script>
</body>